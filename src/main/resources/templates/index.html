<!DOCTYPE html>
<html lang="es-AR" xmlns:th="https://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${titulo}"></title>

  <link rel="icon" type="image/png" th:href="@{/img/clubfit-removebg-preview.png}">

</head>

<body>
  <!-- Esta va a ser la parte que se debe reeemplazar en las demas páginas, el contenido -->
  <div layout:fragment="contenido">
    <header>
      <h2>CONTROL DE ACCESO</h2>
      <input type="text" id="busqueda" placeholder="NOMBRE / DNI / ID" autofocus>
    </header>

    <section class="info-socio">
      <div id="alertas" class="alertas">
        <!-- Mensajes dinámicos -->
      </div>

      <div id="tarjeta" class="tarjeta" style="display:none;">
        <img id="foto-socio" src="/img/perfil.jpg" alt="Foto socio" class="foto-socio">
        <div id="datos-socio" class="datos">
          <!-- Se llenará con JS -->
        </div>
      </div>

      <div id="estado" class="estado" style="display:none;">
        <!-- Mensaje de estado -->
      </div>
    </section>
  </div>

  <!-- Mis JS -->
  <!-- <script th:fragment="js"></script> -->
  <script th:fragment="js">
    document.getElementById('busqueda').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        const dni = this.value.trim();
        if (dni === '') return;

        fetch(`/api/socios/dni?dni=${encodeURIComponent(dni)}`)
          .then(response => {
            if (!response.ok) throw new Error('Socio no encontrado');
            return response.json();
          })
          .then(socio => {
            // Mostrar datos
            document.getElementById('datos-socio').innerHTML = `
              <p><strong>Nombre:</strong> ${socio.nombreCompleto}</p>
              <p><strong>Actividad:</strong> ${socio.actividad || 'N/A'}</p>
              <p><strong>Frecuencia:</strong> ${socio.vecesIngresado || 0} veces ingresado</p>
              <p><strong>Vencimiento:</strong> ${socio.fechaVencimiento ? new Date(socio.fechaVencimiento).toLocaleDateString('es-AR') : 'N/A'}</p>
              <p><strong>Ultimo Ingreso:</strong> ${socio.ultIngreso
                ? new Date(socio.ultIngreso).toLocaleString('es-AR', {
                  dateStyle: 'short',
                  timeStyle: 'short',
                  hourCycle: 'h23' //fuerza formato 24 horas
                })
                : 'N/A'}
              </p>
            `;
            document.getElementById('tarjeta').style.display = 'flex';

            // Estado cuota
            const estadoDiv = document.getElementById('estado');
            estadoDiv.style.display = 'block';
            if (socio.cuotaPaga === false) {
              estadoDiv.innerHTML = '<h3>CUOTA VENCIDA</h3>';
              estadoDiv.className = 'estado cuota-vencida';
            } else {
              estadoDiv.innerHTML = '<h3>CUOTA AL DÍA</h3>';
              estadoDiv.className = 'estado cuota-al-dia';
            }

            // Limpiar alertas previas
            document.getElementById('alertas').innerHTML = '';
          })
          .catch(() => {
            document.getElementById('alertas').innerHTML = '<div class="error">❌ Socio no encontrado</div>';
            document.getElementById('tarjeta').style.display = 'none';
            document.getElementById('estado').style.display = 'none';
          });
      }
    });
  </script>

</body>

</html>